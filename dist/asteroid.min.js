!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("wolfy87-eventemitter")):"function"==typeof define&&define.amd?define(["wolfy87-eventemitter"],e):"object"==typeof exports?exports.Asteroid=e(require("wolfy87-eventemitter")):t.Asteroid=e(t["wolfy87-eventemitter"])}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}function o(t){return t&&t.__esModule?t:{"default":t}}function u(t){var e=[f,p,h,y].concat(t),n=function(){var t=this,n=arguments;e.forEach(function(e){var r=e.init;return r&&r.apply(t,n)})};return n.prototype=e.reduce(function(t,e){return i({},t,e)},s["default"].prototype),delete n.prototype.init,n}Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.createClass=u;var c=n(1),s=o(c),a=n(2),f=r(a),l=n(4),p=r(l),d=n(5),h=r(d),v=n(19),y=r(v)},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){var e=this,n=t.endpoint,r=t.SocketConstructor,o=void 0===r?WebSocket:r;this.endpoint=n,this.ddp=new i["default"]({endpoint:n,SocketConstructor:o}).on("connected",function(){return e.emit("connected")}).on("disconnected",function(){return e.emit("disconnected")})}Object.defineProperty(e,"__esModule",{value:!0}),e.init=o;var u=n(3),i=r(u)},function(t,e,n){!function(e,r){t.exports=r(n(1))}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(t,e,n){for(var r=!0;r;){var o=t,u=e,i=n;c=a=s=void 0,r=!1,null===o&&(o=Function.prototype);var c=Object.getOwnPropertyDescriptor(o,u);if(void 0!==c){if("value"in c)return c.value;var s=c.get;return void 0===s?void 0:s.call(i)}var a=Object.getPrototypeOf(o);if(null===a)return void 0;t=a,e=u,n=i,r=!0}},s=n(1),a=r(s),f=n(2),l=r(f),p=n(3),d=r(p),h=n(4),v="1",y=["ready","nosub","added","changed","removed","result","updated","error"],g=1e4,b=function(t){function e(t){var n=this;o(this,e),c(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.status="disconnected",this.messageQueue=new l["default"](function(t){return"connected"===n.status?(n.socket.send(t),!0):!1}),this.socket=new d["default"](t.SocketConstructor,t.endpoint),this.socket.on("open",function(){n.socket.send({msg:"connect",version:v,support:[v]})}),this.socket.on("close",function(){n.status="disconnected",n.messageQueue.empty(),n.emit("disconnected"),setTimeout(n.socket.connect.bind(n.socket),g)}),this.socket.on("message:in",function(t){"connected"===t.msg?(n.status="connected",n.messageQueue.process(),n.emit("connected")):"ping"===t.msg?n.socket.send({msg:"pong",id:t.id}):h.contains(y,t.msg)&&n.emit(t.msg,t)}),this.socket.connect()}return u(e,t),i(e,[{key:"emit",value:function(){var t=this,n=arguments;setTimeout(function(){c(Object.getPrototypeOf(e.prototype),"emit",t).apply(t,n)},0)}}]),i(e,[{key:"method",value:function(t,e){var n=h.uniqueId();return this.messageQueue.push({msg:"method",id:n,method:t,params:e}),n}},{key:"sub",value:function(t,e){var n=h.uniqueId();return this.messageQueue.push({msg:"sub",id:n,name:t,params:e}),n}},{key:"unsub",value:function(t){return this.messageQueue.push({msg:"unsub",id:t}),t}}]),e}(a["default"]);e["default"]=b,t.exports=e["default"]},function(e,n){e.exports=t},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e){n(this,t),this.consumer=e,this.queue=[]}return r(t,[{key:"push",value:function(t){this.queue.push(t),this.process()}},{key:"process",value:function(){var t=this;setTimeout(function(){if(0!==t.queue.length){var e=t.consumer(t.queue[0]);e&&(t.queue.shift(),t.process())}},0)}},{key:"empty",value:function(){this.queue=[]}}]),t}();e["default"]=o,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(t,e,n){for(var r=!0;r;){var o=t,u=e,i=n;c=a=s=void 0,r=!1,null===o&&(o=Function.prototype);var c=Object.getOwnPropertyDescriptor(o,u);if(void 0!==c){if("value"in c)return c.value;var s=c.get;return void 0===s?void 0:s.call(i)}var a=Object.getPrototypeOf(o);if(null===a)return void 0;t=a,e=u,n=i,r=!0}},s=n(1),a=r(s),f=function(t){function e(t,n){o(this,e),c(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.SocketConstructor=t,this.endpoint=n}return u(e,t),i(e,[{key:"emit",value:function(){var t=this,n=arguments;setTimeout(function(){c(Object.getPrototypeOf(e.prototype),"emit",t).apply(t,n)},0)}}]),i(e,[{key:"send",value:function(t){var e=JSON.stringify(t);this.rawSocket.send(e),this.emit("message:out",JSON.parse(e))}},{key:"connect",value:function(){var t=this;this.rawSocket=new this.SocketConstructor(this.endpoint),this.rawSocket.onopen=function(){return t.emit("open")},this.rawSocket.onerror=function(e){return t.emit("error",e)},this.rawSocket.onclose=function(){return t.emit("close")},this.rawSocket.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(r){return}t.emit("message:in",n)}}}]),e}(a["default"]);e["default"]=f,t.exports=e["default"]},function(t,e){"use strict";function n(){return(o++).toString()}function r(t,e){return-1!==t.indexOf(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.uniqueId=n,e.contains=r;var o=0}])})},function(t,e){"use strict";function n(t,e){var n=this;return new Promise(function(r,o){var u=n.ddp.method(t,e);n.methods.cache[u]={resolve:r,reject:o}})}function r(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return this.apply(t,n)}function o(){var t=this;this.methods={cache:{}},this.ddp.on("result",function(e){var n=e.id,r=e.error,o=e.result,u=t.methods.cache[n];r?u.reject(r):u.resolve(o),delete t.methods.cache[n]})}Object.defineProperty(e,"__esModule",{value:!0}),e.apply=n,e.call=r,e.init=o},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function u(t){var e=t.id,n=t.name,r=t.params,u=t.stillInQueue;u||(this.subscriptions.cache.del(e),this.subscribe.apply(this,[n].concat(o(r))))}function i(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];var o=y["default"](t,n),u=this.subscriptions.cache.get(o);if(!u){var i=this.ddp.sub(t,n),c="connected"!==this.ddp.status;u=f["default"](new p["default"],{fingerprint:o,id:i,name:t,params:n,stillInQueue:c}),this.subscriptions.cache.add(u)}return u}function c(t){this.ddp.unsub(t)}function s(){var t=this;this.subscriptions={cache:new h["default"]},this.ddp.on("ready",function(e){var n=e.subs;n.forEach(function(e){t.subscriptions.cache.get(e).emit("ready")})}).on("nosub",function(e){var n=e.error,r=e.id;n&&t.subscriptions.cache.get(r).emit("error",n),t.subscriptions.cache.del(r)}).on("connected",function(){t.subscriptions.cache.forEach(u.bind(t))})}Object.defineProperty(e,"__esModule",{value:!0}),e.subscribe=i,e.unsubscribe=c,e.init=s;var a=n(6),f=r(a),l=n(1),p=r(l),d=n(17),h=r(d),v=n(18),y=r(v)},function(t,e,n){function r(t,e,n){for(var r=-1,o=i(e),u=o.length;++r<u;){var c=o[r],s=t[c],a=n(s,e[c],c,t,e);(a===a?a===s:s!==s)&&(void 0!==s||c in t)||(t[c]=a)}return t}var o=n(7),u=n(13),i=n(9),c=u(function(t,e,n){return n?r(t,e,n):o(t,e)});t.exports=c},function(t,e,n){function r(t,e){return null==e?t:o(e,u(e),t)}var o=n(8),u=n(9);t.exports=r},function(t,e){function n(t,e,n){n||(n={});for(var r=-1,o=e.length;++r<o;){var u=e[r];n[u]=t[u]}return n}t.exports=n},function(t,e,n){function r(t){return function(e){return null==e?void 0:e[t]}}function o(t){return null!=t&&i(b(t))}function u(t,e){return t="number"==typeof t||d.test(t)?+t:-1,e=null==e?g:e,t>-1&&t%1==0&&e>t}function i(t){return"number"==typeof t&&t>-1&&t%1==0&&g>=t}function c(t){for(var e=a(t),n=e.length,r=n&&t.length,o=!!r&&i(r)&&(p(t)||l(t)),c=-1,s=[];++c<n;){var f=e[c];(o&&u(f,r)||v.call(t,f))&&s.push(f)}return s}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function a(t){if(null==t)return[];s(t)||(t=Object(t));var e=t.length;e=e&&i(e)&&(p(t)||l(t))&&e||0;for(var n=t.constructor,r=-1,o="function"==typeof n&&n.prototype===t,c=Array(e),a=e>0;++r<e;)c[r]=r+"";for(var f in t)a&&u(f,e)||"constructor"==f&&(o||!v.call(t,f))||c.push(f);return c}var f=n(10),l=n(11),p=n(12),d=/^\d+$/,h=Object.prototype,v=h.hasOwnProperty,y=f(Object,"keys"),g=9007199254740991,b=r("length"),m=y?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&o(t)?c(t):s(t)?y(t):[]}:c;t.exports=m},function(t,e){function n(t){return!!t&&"object"==typeof t}function r(t,e){var n=null==t?void 0:t[e];return i(n)?n:void 0}function o(t){return u(t)&&p.call(t)==c}function u(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function i(t){return null==t?!1:o(t)?d.test(f.call(t)):n(t)&&s.test(t)}var c="[object Function]",s=/^\[object .+?Constructor\]$/,a=Object.prototype,f=Function.prototype.toString,l=a.hasOwnProperty,p=a.toString,d=RegExp("^"+f.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},function(t,e){function n(t){return!!t&&"object"==typeof t}function r(t){return function(e){return null==e?void 0:e[t]}}function o(t){return null!=t&&u(l(t))}function u(t){return"number"==typeof t&&t>-1&&t%1==0&&f>=t}function i(t){return n(t)&&o(t)&&s.call(t,"callee")&&!a.call(t,"callee")}var c=Object.prototype,s=c.hasOwnProperty,a=c.propertyIsEnumerable,f=9007199254740991,l=r("length");t.exports=i},function(t,e){function n(t){return!!t&&"object"==typeof t}function r(t,e){var n=null==t?void 0:t[e];return c(n)?n:void 0}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&g>=t}function u(t){return i(t)&&h.call(t)==a}function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){return null==t?!1:u(t)?v.test(p.call(t)):n(t)&&f.test(t)}var s="[object Array]",a="[object Function]",f=/^\[object .+?Constructor\]$/,l=Object.prototype,p=Function.prototype.toString,d=l.hasOwnProperty,h=l.toString,v=RegExp("^"+p.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),y=r(Array,"isArray"),g=9007199254740991,b=y||function(t){return n(t)&&o(t.length)&&h.call(t)==s};t.exports=b},function(t,e,n){function r(t){return i(function(e,n){var r=-1,i=null==e?0:n.length,c=i>2?n[i-2]:void 0,s=i>2?n[2]:void 0,a=i>1?n[i-1]:void 0;for("function"==typeof c?(c=o(c,a,5),i-=2):(c="function"==typeof a?a:void 0,i-=c?1:0),s&&u(n[0],n[1],s)&&(c=3>i?void 0:c,i=1);++r<i;){var f=n[r];f&&t(e,f,c)}return e})}var o=n(14),u=n(15),i=n(16);t.exports=r},function(t,e){function n(t,e,n){if("function"!=typeof t)return r;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,o){return t.call(e,n,r,o)};case 4:return function(n,r,o,u){return t.call(e,n,r,o,u)};case 5:return function(n,r,o,u,i){return t.call(e,n,r,o,u,i)}}return function(){return t.apply(e,arguments)}}function r(t){return t}t.exports=n},function(t,e){function n(t){return function(e){return null==e?void 0:e[t]}}function r(t){return null!=t&&i(f(t))}function o(t,e){return t="number"==typeof t||s.test(t)?+t:-1,e=null==e?a:e,t>-1&&t%1==0&&e>t}function u(t,e,n){if(!c(n))return!1;var u=typeof e;if("number"==u?r(n)&&o(e,n.length):"string"==u&&e in n){var i=n[e];return t===t?t===i:i!==i}return!1}function i(t){return"number"==typeof t&&t>-1&&t%1==0&&a>=t}function c(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var s=/^\d+$/,a=9007199254740991,f=n("length");t.exports=u},function(t,e){function n(t,e){if("function"!=typeof t)throw new TypeError(r);return e=o(void 0===e?t.length-1:+e||0,0),function(){for(var n=arguments,r=-1,u=o(n.length-e,0),i=Array(u);++r<u;)i[r]=n[e+r];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,n[0],i);case 2:return t.call(this,n[0],n[1],i)}var c=Array(e+1);for(r=-1;++r<e;)c[r]=n[r];return c[e]=i,t.apply(this,c)}}var r="Expected a function",o=Math.max;t.exports=n},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){n(this,t),this.byFingerprint={},this.byId={}}return r(t,[{key:"add",value:function(t){this.byFingerprint[t.fingerprint]=t,this.byId[t.id]=t}},{key:"get",value:function(t){return this.byId[t]||this.byFingerprint[t]||null}},{key:"del",value:function(t){var e=this.get(t)||{};delete this.byFingerprint[e.fingerprint],delete this.byId[e.id]}},{key:"forEach",value:function(t){var e=this;Object.keys(this.byId).forEach(function(n){t(e.byId[n])})}}]),t}();e["default"]=o,t.exports=e["default"]},function(t,e){"use strict";function n(t,e){return JSON.stringify({name:t,params:e})}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return this.call("login",t).then(i.onLogin.bind(this))}function o(){return this.call("logout").then(i.onLogout.bind(this))}function u(){this.userId=null,this.loggedIn=!1,this.ddp.on("connected",i.resumeLogin.bind(this))}Object.defineProperty(e,"__esModule",{value:!0}),e.login=r,e.logout=o,e.init=u;var i=n(20)},function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}function o(t){var e=t.id,n=t.token;return this.userId=e,this.loggedIn=!0,s.set(this.endpoint+"__login_token__",n).then(this.emit.bind(this,"loggedIn",e))}function u(){return this.userId=null,this.loggedIn=!1,s.del(this.endpoint+"__login_token__").then(this.emit.bind(this,"loggedOut"))}function i(){return s.get(this.endpoint+"__login_token__").then(function(t){if(!t)throw new Error("No login token");return{resume:t}}).then(this.login.bind(this))["catch"](u.bind(this))}Object.defineProperty(e,"__esModule",{value:!0}),e.onLogin=o,e.onLogout=u,e.resumeLogin=i;var c=n(21),s=r(c)},function(t,e){"use strict";function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){return new Promise(function(e){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.get(t,function(n){return e(n[t])}):e("undefined"!=typeof localStorage?localStorage[t]:i[t])})}function o(t,e){return new Promise(function(r){if("undefined"!=typeof chrome&&chrome.storage){var o=n({},t,e);chrome.storage.local.set(o,r)}else"undefined"!=typeof localStorage?(localStorage[t]=e,r()):(i[t]=e,r())})}function u(t){return new Promise(function(e){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.remove(t,e):"undefined"!=typeof localStorage?(delete localStorage[t],e()):(delete i[t],e())})}Object.defineProperty(e,"__esModule",{value:!0}),e.get=r,e.set=o,e.del=u;var i={}}])});